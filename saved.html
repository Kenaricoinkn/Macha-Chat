<!doctype html><html lang="id"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tersimpan — MACHA CHAT</title>
<script src="https://cdn.tailwindcss.com"></script>
</head><body class="bg-slate-900 text-slate-100">
<header class="p-3 border-b border-white/10"><a href="./dashboard.html">← Kembali</a></header>
<main class="max-w-[980px] mx-auto p-4 space-y-3" id="wrap"></main>
<script type="module">
import { auth, db } from './js/config.js'
import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js'
import { collection, query, orderBy, onSnapshot, getDoc, doc } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js'
const cld=(u)=>u?.includes('/upload/')?u.replace('/upload/','/upload/w_600,q_auto,f_auto/'):u
onAuthStateChanged(auth, user=>{
  if(!user){ location.replace('./index.html'); return }
  const wrap=document.getElementById('wrap')
  const q=query(collection(db, `users/${user.uid}/saved`), orderBy('savedAt','desc'))
  onSnapshot(q, async (snap)=>{
    wrap.innerHTML=''
    for(const d of snap.docs){
      const pid = d.data().postId
      const pSnap = await getDoc(doc(db,'posts',pid))
      if(!pSnap.exists()) continue
      const p = pSnap.data()
      const media = p.imageURL ? `<img src="${cld(p.imageURL)}" class="w-full rounded-2xl">`
                 : p.videoURL ? `<video src="${cld(p.videoURL,'w_640,q_auto,f_auto')}" controls preload="metadata" class="w-full bg-black rounded-2xl"></video>` : ''
      const el=document.createElement('article')
      el.className='rounded-3xl border border-white/10 bg-slate-800/60 p-4'
      el.innerHTML = `<div class="font-semibold">${p.author||'Pengguna'}</div>${p.text?`<div class="mt-2">${p.text}</div>`:''}${media?`<div class="mt-3">${media}</div>`:''}`
      wrap.appendChild(el)
    }
  })
})
</script>
</body></html>
